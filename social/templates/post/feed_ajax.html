{% load humanize static %}

{% for post in posts %}
<article class="bg-zinc-800 rounded-lg overflow-hidden mb-8">

  <!-- HEADER -->
  <header class="flex items-center px-4 py-3">
    {% if post.author.photo %}
      <img src="{{ post.author.photo.url }}"
           class="w-8 h-8 rounded-full object-cover mr-3"/>
    {% else %}
      <div class="w-8 h-8 rounded-full bg-zinc-700 mr-3
                  flex items-center justify-center text-zinc-300 uppercase text-sm">
        {{ post.author.username|first }}
      </div>
    {% endif %}
    <a href="{{ post.author.get_absolute_url }}"
       class="font-semibold text-zinc-100">{{ post.author.username }}</a>
  </header>

  <!-- IMAGE -->
  <div class="relative w-full" style="padding-top:100%;">
    {% with img=post.images.first %}
      {% if img %}
        <img src="{{ img.image_file.url }}"
             class="absolute inset-0 w-full h-full object-cover"/>
      {% else %}
        <div class="absolute inset-0 bg-zinc-700 flex items-center justify-center text-zinc-500">
          No Image
        </div>
      {% endif %}
    {% endwith %}
  </div>

  <!-- ACTIONS -->
  <div class="flex items-center px-4 py-3 space-x-4">
    <!-- ❤️ Like -->
    <button class="like-btn" data-post-id="{{ post.id }}">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 {% if user in post.likes.all %}text-red-500{% else %}text-zinc-300{% endif %}"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4.318 6.318a4.5 4.5 0
                 016.364 0L12 7.636l1.318-1.318
                 a4.5 4.5 0 116.364 6.364L12
                 21.364l-7.682-7.682a4.5
                 4.5 0 010-6.364z" />
      </svg>
    </button>

    <!-- 💬 Comment / Detail -->
    <button class="comment-btn"
            data-detail-url="{% url 'social:post_detail' post.id %}">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 text-zinc-300 hover:text-zinc-100 transition"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 10h.01M12 10h.01M16 10h.01M21 12
                 c0 4.418-4.03 8-9 8a9.863 9.863 0
                 01-5-.5L3 21l1.5-5A9.863 9.863
                 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
      </svg>
    </button>

    <!-- ✉️ Message -->
    <button class="message-btn"
            data-recipient="{{ post.author.id }}"
            data-post-id="{{ post.id }}"
            title="Message">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 text-zinc-300 hover:text-zinc-100 transition"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 19l9-7-9-7-2 3 7 4-7 4 2 3z" />
      </svg>
    </button>

    <div class="flex-1"></div>

    <!-- 🔖 Save -->
    <button class="save-btn" data-post-id="{{ post.id }}">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 {% if user in post.saved_by.all %}text-purple-400{% else %}text-zinc-300{% endif %}"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 5v14l7-7 7 7V5H5z" />
      </svg>
    </button>
  </div>

  <!-- LIKES COUNT -->
  <div class="px-4">
    <p class="likes-count font-semibold text-zinc-100">
      {{ post.likes.count }} likes
    </p>
  </div>

  <!-- DESCRIPTION & TAGS -->
  <div class="px-4 pt-2 text-zinc-200 text-sm">
    <span class="font-semibold">{{ post.author.username }}</span>
    <span>{{ post.description|truncatechars:100 }}</span>
  </div>
  {% if post.tags.all %}
    <div class="px-4 pb-2">
      {% for tag in post.tags.all %}
        <a href="{% url 'social:post_list_by_tag' tag.slug %}"
           class="text-purple-400 text-sm hover:underline mr-2">
          #{{ tag.name }}
        </a>
      {% endfor %}
    </div>
  {% endif %}

  <!-- VIEW COMMENTS -->
  {% if post.comments.count %}
    <a href="#"
       class="block px-4 pt-2 text-zinc-400 text-xs hover:underline view-comments"
       data-detail-url="{% url 'social:post_detail' post.id %}">
      View {{ post.comments.count }} comments
    </a>
  {% endif %}

</article>
{% empty %}
  <p class="text-zinc-500 px-4">Your feed is empty.</p>
{% endfor %}
